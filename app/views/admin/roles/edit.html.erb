<% content_for :left do %>
	<%= render :partial => 'admin/companies/menu', :locals => {:active => :roles} %>
<% end %>

<div class='content company'>
		
	<form>
	
		<%= render :partial => 'admin/shared/actions_bar' %>

		<ul class='role'>
			<li>
				<h3 class='heading'>permission name</h3>
				<input type='text' for='' name='permission[name]' class='name' value='Type Permission Name Here' onfocus='if(this.value=="Type Permission Name Here")value=""' onblur='if(this.value=="")this.value="Type Permission Name Here"' />
			</li>

			<li>
				<h3 class='heading'>assign permissions</h3>
				<ul class='roles'>
					<% action_tree.each do |key, node| %>
						<%= build_action_list_item(key, node) %>
					<% end %>
				</ul>
			</li>
		</ul>
		
	</form>
</div>

<script type='text/javascript'>
	$(document).ready(function () {
		$(".checkbox").dgStyle()
		addActionClickEvent()
		addParentActionClickEvent()
	})

	function addActionClickEvent () {
		$(".role-actions input:checkbox").each(function (){
			$(this).change(updateCheckedActions)
		})
	}

	function addParentActionClickEvent () {
		$(".role-actions input:checkbox.parent").each(function (){
			$(this).change(function () {
				var checked = $(this).attr('checked')
				$(this).parent().parent().find('ul li input:checkbox').each(function () {
					$(this).attr('checked', checked)
					$(this).parent().dgHandle()
				})
				updateCheckedActions()
			})
		})
	}

	function updateCheckedActions () {
		ids = new Array()
		$(".role-actions input:checkbox:checked").each(function () {
			if (this.name != '') {
				ids.push(this.name.replace(/action_/, ''))
			}
		})
		$('#role_action_ids').val(ids.toString())
	}
</script>